name: ubuntu latest

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  BUILD_TYPE: Debug
  LOCAL: local

jobs:
  build:
    runs-on: ubuntu-latest
    container: "iowarp/iowarp-user:latest"
    steps:
      - name: Get Sources
        uses: actions/checkout@v4
      - name: Build
        run: |
          . /module_load.sh
          pushd .
          cd /root/spack
          . ./share/spack/setup-env.sh
          which spack
          spack compiler find
          spack repo list
          spack find
          spack load iowarp@main
          popd
          mkdir build
          cd build
          cmake ..
          ctest -D Experimental -C Release
        shell: bash
